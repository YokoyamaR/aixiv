<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIXiv — Report</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400&display=swap');

    :root {
      --bg: #f5f5f0;
      --surface: #fff;
      --border: #ccc;
      --text: #1a1a1a;
      --text-muted: #555;
      --accent: #8b0000;
      --link: #00529b;
      --link-hover: #003366;
      --code-bg: #f0ede6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Source Serif 4", "Noto Serif JP", "Times New Roman", Georgia, serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.9;
      font-size: 16px;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { color: var(--link-hover); text-decoration: underline; }

    .topbar {
      border-bottom: 2px solid var(--accent);
      padding: 0.5rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--surface);
      z-index: 10;
      font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
      font-size: 0.85rem;
    }

    .topbar a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    .topbar a:hover { text-decoration: underline; }

    .topbar .title {
      font-weight: 400;
      font-size: 0.85rem;
      color: var(--text-muted);
      max-width: 60%;
      text-align: right;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Paper container — mimics academic paper */
    .paper {
      max-width: 720px;
      margin: 2rem auto;
      padding: 3rem 3.5rem 4rem;
      background: var(--surface);
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }

    @media (max-width: 800px) {
      .paper {
        margin: 0;
        padding: 1.5rem;
        box-shadow: none;
      }
    }

    /* Title — academic style */
    .article h1 {
      font-size: 1.7rem;
      font-weight: 700;
      margin: 0 0 1.5rem;
      text-align: center;
      line-height: 1.4;
      color: var(--text);
    }

    /* Section headings */
    .article h2 {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 2.5rem 0 0.8rem;
      padding-bottom: 0.2rem;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }

    .article h3 {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 1.8rem 0 0.5rem;
      color: var(--text);
    }

    .article h4 {
      font-size: 1rem;
      font-weight: 700;
      margin: 1.2rem 0 0.4rem;
      font-style: italic;
    }

    .article p {
      margin: 0.7rem 0;
      text-align: justify;
    }

    .article ul, .article ol {
      margin: 0.8rem 0;
      padding-left: 2rem;
    }

    .article li {
      margin: 0.25rem 0;
    }

    /* Abstract / blockquote styling */
    .article blockquote {
      border: 1px solid var(--border);
      padding: 1rem 1.2rem;
      margin: 1.5rem 1rem;
      color: var(--text);
      background: var(--code-bg);
      border-radius: 2px;
      font-size: 0.92em;
      line-height: 1.8;
    }

    /* Tables — academic style */
    .article table {
      border-collapse: collapse;
      width: 100%;
      margin: 1.5rem 0;
      font-size: 0.9rem;
    }

    .article caption, .article table + p em {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-align: center;
      display: block;
    }

    .article th, .article td {
      border: 1px solid #999;
      padding: 0.4rem 0.7rem;
      text-align: left;
    }

    .article th {
      background: var(--code-bg);
      font-weight: 700;
    }

    .article code {
      background: var(--code-bg);
      padding: 0.1rem 0.35rem;
      border-radius: 2px;
      font-size: 0.88em;
      font-family: "SF Mono", "Consolas", "Liberation Mono", monospace;
    }

    .article pre {
      background: var(--code-bg);
      padding: 1rem;
      border-radius: 2px;
      overflow-x: auto;
      margin: 1rem 0;
      border: 1px solid var(--border);
      font-size: 0.85em;
    }

    .article pre code {
      background: none;
      padding: 0;
    }

    .article hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 2.5rem 0;
    }

    .article strong {
      font-weight: 700;
    }

    .article em {
      font-style: italic;
    }

    /* Footnotes / references style */
    .article sup {
      font-size: 0.75em;
      line-height: 0;
    }

    /* Loading / Error */
    .loading {
      text-align: center;
      padding: 4rem;
      color: var(--text-muted);
      font-family: sans-serif;
    }

    .error {
      text-align: center;
      padding: 4rem;
      color: var(--accent);
      font-family: sans-serif;
    }

    /* Paper metadata banner */
    .paper-meta-banner {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
      font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
      font-size: 0.85rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .paper-meta-banner .meta-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 0.3rem;
    }

    .ai-disclaimer {
      font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
      background: #fff8e1;
      border: 1px solid #e6c84c;
      border-radius: 3px;
      padding: 0.6rem 0.8rem;
      margin: 1.5rem 0;
      font-size: 0.78rem;
      color: #665500;
      line-height: 1.6;
    }

    .ai-disclaimer strong {
      color: #554400;
    }

    .paper-footer-disclaimer {
      font-family: "Helvetica Neue", "Noto Sans JP", Arial, sans-serif;
      border-top: 1px solid var(--border);
      margin-top: 3rem;
      padding-top: 1rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <a href="./">← AIXiv</a>
    <span class="title" id="page-title"></span>
  </div>
  <div class="paper">
    <div id="content" class="loading">Loading...</div>
  </div>
  <script>
    const VIEW_API = 'https://script.google.com/macros/s/AKfycbyGBHtvr-JjcKL57eIcVATnPuWyr_bcY2kxRw-FFQ4_caJlMWL5uugzXPOubQqSJTQD/exec';

    async function loadPaper() {
      const params = new URLSearchParams(window.location.search);
      const file = params.get('f');
      const contentEl = document.getElementById('content');

      if (!file) {
        contentEl.className = 'error';
        contentEl.textContent = 'No file specified.';
        return;
      }

      // Extract metadata from filename
      const dateMatch = file.match(/^(\d{4}-\d{2}-\d{2})/);
      const lang = file.endsWith('_ja.md') ? 'ja' : file.endsWith('_en.md') ? 'en' : '';

      // Fire-and-forget: count view and capture promise for later display
      const viewCountPromise = fetch(`${VIEW_API}?action=count&paper=${encodeURIComponent(file)}`)
        .then(r => r.json()).catch(() => null);

      try {
        const resp = await fetch(`papers/${file}`);
        if (!resp.ok) throw new Error(`${resp.status}`);
        let text = await resp.text();

        // Extract and strip frontmatter
        let frontmatter = {};
        if (text.startsWith('---')) {
          const parts = text.split('---');
          if (parts.length >= 3) {
            const fmText = parts[1];
            fmText.split('\n').forEach(line => {
              const idx = line.indexOf(':');
              if (idx > 0) {
                const key = line.substring(0, idx).trim();
                const val = line.substring(idx + 1).trim().replace(/^"/, '').replace(/"$/, '');
                frontmatter[key] = val;
              }
            });
            text = parts.slice(2).join('---');
          }
        }

        contentEl.className = 'article';
        contentEl.innerHTML = marked.parse(text);

        // Set page title
        const h1 = contentEl.querySelector('h1');
        if (h1) {
          document.getElementById('page-title').textContent = h1.textContent;
          document.title = h1.textContent + ' — AIXiv';
        }

        // Insert metadata banner after h1
        if (h1) {
          const metaBanner = document.createElement('div');
          metaBanner.className = 'paper-meta-banner';

          const rounds = frontmatter.rounds || '100';
          const date = frontmatter.date || (dateMatch ? dateMatch[1] : '');
          const langLabel = lang === 'ja' ? '日本語' : lang === 'en' ? 'English' : '';

          let metaHTML = '<div class="meta-label">AIXiv Report</div>';
          if (date) metaHTML += `<div>Published: ${date}</div>`;
          metaHTML += `<div>Generated from ${rounds}-round AI-simulated expert panel discussion</div>`;
          if (langLabel) metaHTML += `<div>Language: ${langLabel}</div>`;

          metaHTML += '<div id="view-count"></div>';
          metaBanner.innerHTML = metaHTML;
          h1.after(metaBanner);

          // Show view count when API responds (non-blocking)
          viewCountPromise.then(data => {
            if (data && data.count != null) {
              document.getElementById('view-count').textContent = 'Views: ' + data.count;
            }
          });

          // AI生成の注記（メタバナーの直後）
          const aiNotice = document.createElement('div');
          aiNotice.className = 'ai-disclaimer';
          if (lang === 'ja') {
            aiNotice.innerHTML = '<strong>AI生成コンテンツ:</strong> 本レポートはAnthropicのAIモデル「Claude」が各分野の専門家を模擬して生成したものです。人間の専門家による査読・検証は行われていません。内容の正確性・完全性は保証されません。';
          } else {
            aiNotice.innerHTML = '<strong>AI-Generated Content:</strong> This report was generated by Anthropic\'s AI model "Claude" simulating domain experts. It has not been peer-reviewed or verified by human specialists. Accuracy and completeness are not guaranteed.';
          }
          metaBanner.after(aiNotice);
        }

        // レポート末尾にも免責事項を追加
        const footerDisclaimer = document.createElement('div');
        footerDisclaimer.className = 'paper-footer-disclaimer';
        if (lang === 'ja') {
          footerDisclaimer.innerHTML = '<strong>免責事項:</strong> 本レポートはAI（Anthropic Claude）によって自動生成されたものであり、人間の専門家による執筆・査読・検証を経ていません。生成には高性能AIモデルの大量消費を伴うため、Claude Pro/Maxプランでの <a href="https://claude.ai/download">Claude Code</a> 利用またはAnthropic APIの利用を想定しています。学術引用や意思決定に利用する際は、必ず一次資料を確認してください。<br>Generated by AIXiv — AI + arXiv';
        } else {
          footerDisclaimer.innerHTML = '<strong>Disclaimer:</strong> This report was automatically generated by AI (Anthropic Claude) and has not been written, peer-reviewed, or verified by human experts. Generation consumes significant high-performance AI model usage; it is designed for <a href="https://claude.ai/download">Claude Code</a> with a Claude Pro/Max plan or the Anthropic API. When citing for academic or decision-making purposes, always consult primary sources.<br>Generated by AIXiv — AI + arXiv';
        }
        contentEl.appendChild(footerDisclaimer);

      } catch (e) {
        contentEl.className = 'error';
        contentEl.textContent = `Failed to load report (${e.message})`;
      }
    }
    loadPaper();
  </script>
</body>
</html>
