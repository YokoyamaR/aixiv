#!/usr/bin/env bash
set -euo pipefail

# ============================================================
#  AIchive — テーマを投げるだけでレポートを公開
#
#  使い方:
#    ./forge "法律の耐用年数と国家の変容"
#
#  前提条件:
#    - Claude Code がインストールされていること
#    - Claude Pro/Max プランに加入していること
# ============================================================

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

if [ $# -eq 0 ]; then
  echo ""
  echo "  AIchive — 思考実験レポート自動生成"
  echo ""
  echo "  使い方:"
  echo "    ./forge \"テーマをここに書く\""
  echo ""
  echo "  または Claude Code から直接:"
  echo "    /forge テーマをここに書く"
  echo ""
  echo "  前提条件:"
  echo "    - Claude Code (claude) がインストールされていること"
  echo "    - Claude Pro または Max プランに加入していること"
  echo ""
  echo "  テーマを与えるだけで:"
  echo "    1. AIが最適な専門家パネルを自動構成"
  echo "    2. 100ラウンドのパネルディスカッションを実行"
  echo "    3. 日本語+英語の学術レポートを生成"
  echo "    4. GitHub Pages に自動公開"
  echo ""
  exit 0
fi

THEME_TEXT="$1"

# ── Claude Code の確認 ──
if ! command -v claude &>/dev/null; then
  echo "Error: Claude Code がインストールされていません。"
  echo ""
  echo "  インストール:"
  echo "    npm install -g @anthropic-ai/claude-code"
  echo ""
  echo "  詳細: https://docs.anthropic.com/en/docs/claude-code"
  echo ""
  exit 1
fi

echo ""
echo "============================================================"
echo "  AIchive"
echo "============================================================"
echo ""
echo "  テーマ: ${THEME_TEXT}"
echo ""
echo "============================================================"
echo ""
echo "Claude Code で /forge コマンドを実行します..."
echo ""

cd "$SCRIPT_DIR"
claude "/forge ${THEME_TEXT}"
